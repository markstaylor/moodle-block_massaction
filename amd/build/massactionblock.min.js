function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_massaction/massactionblock",["exports","./checkboxmanager","core/str","core/ajax","core/pending"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.setSectionSelection=a.init=a.constants=a.cssIds=a.usedMoodleCssClasses=void 0;b=h(b);c=g(c);d=h(d);e=h(e);function f(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;f=function(){return a};return a}function g(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=f();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var g=d?Object.getOwnPropertyDescriptor(a,e):null;if(g&&(g.get||g.set)){Object.defineProperty(c,e,g)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function j(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){i(h,d,e,f,g,"next",a)}function g(a){i(h,d,e,f,g,"throw",a)}f(void 0)})}}var k={},l=!1,m={SECTION_NAME:"sectionname",MODULE_ID_PREFIX:"module-",SPINNER:"spinner",DNDUPLOAD:"dndupload-progress-outer"};a.usedMoodleCssClasses=m;var n={SELECT_ALL_LINK:"block-massaction-control-selectall",DESELECT_ALL_LINK:"block-massaction-control-deselectall",HIDE_LINK:"block-massaction-action-hide",SHOW_LINK:"block-massaction-action-show",MAKE_AVAILABLE_LINK:"block-massaction-action-makeavailable",DUPLICATE_LINK:"block-massaction-action-duplicate",DELETE_LINK:"block-massaction-action-delete",MOVELEFT_LINK:"block-massaction-action-moveleft",MOVERIGHT_LINK:"block-massaction-action-moveright",MOVETO_ICON_LINK:"block-massaction-action-moveto",SECTION_SELECT:"block-massaction-control-section-list-select",MOVETO_SELECT:"block-massaction-control-section-list-moveto",BOX_ID_PREFIX:"block-massaction-module-selector-",CHECKBOX_CLASS:"block-massaction-checkbox",HIDDEN_FIELD_REQUEST_INFORMATION:"block-massaction-control-request",ACTION_FORM:"block-massaction-control-form"};a.cssIds=n;var o={SECTION_SELECT_DESCRIPTION_VALUE:"description",SECTION_NUMBER_ALL_PLACEHOLDER:"all"};a.constants=o;var p={HIDE:"hide",SHOW:"show",MAKE_AVAILABLE:"makeavailable",DUPLICATE:"duplicate",DELETE:"delete",MOVE_LEFT:"moveleft",MOVE_RIGHT:"moveright",MOVE_TO:"moveto"},q=function(){var a=j(regeneratorRuntime.mark(function a(b){var c,d,f,g,h,i,j,k,l,q,t,w;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:t=new e.default("block_massaction/init");u(b);w=new MutationObserver(function(a){a=a.filter(function(a){return"childList"===a.type});var c=a.filter(function(a){return a.addedNodes&&0<a.addedNodes.length});if(2===c.length&&c.every(function(a){return a.target.classList.contains(m.SECTION_NAME)})){u(b);return}var d=a.filter(function(a){return a.removedNodes&&0<a.removedNodes.length}),e=[];d.forEach(function(a){var b=v(a.removedNodes);if(b){e=e.concat(b)}});if(0<e.length){e.filter(function(a){return 3!==a.nodeType}).forEach(function(a){if(a.classList&&a.classList.contains(m.SPINNER)||a.classList.contains(m.DNDUPLOAD)){u(b)}})}});document.addEventListener("readystatechange",function(a){if("complete"===a.target.readyState){setTimeout(function(){return w.observe(document.body,{subtree:!0,childList:!0,attributes:!1,characterData:!1})},1e3)}});null===(c=document.getElementById(n.SELECT_ALL_LINK))||void 0===c?void 0:c.addEventListener("click",function(){return r(!0,o.SECTION_NUMBER_ALL_PLACEHOLDER)},!1);null===(d=document.getElementById(n.DESELECT_ALL_LINK))||void 0===d?void 0:d.addEventListener("click",function(){return r(!1,o.SECTION_NUMBER_ALL_PLACEHOLDER)},!1);null===(f=document.getElementById(n.HIDE_LINK))||void 0===f?void 0:f.addEventListener("click",function(){return s(p.HIDE)},!1);null===(g=document.getElementById(n.SHOW_LINK))||void 0===g?void 0:g.addEventListener("click",function(){return s(p.SHOW)},!1);null===(h=document.getElementById(n.MAKE_AVAILABLE_LINK))||void 0===h?void 0:h.addEventListener("click",function(){return s(p.MAKE_AVAILABLE)},!1);null===(i=document.getElementById(n.DUPLICATE_LINK))||void 0===i?void 0:i.addEventListener("click",function(){return s(p.DUPLICATE)},!1);null===(j=document.getElementById(n.DELETE_LINK))||void 0===j?void 0:j.addEventListener("click",function(){return s(p.DELETE)},!1);null===(k=document.getElementById(n.MOVELEFT_LINK))||void 0===k?void 0:k.addEventListener("click",function(){return s(p.MOVE_LEFT)},!1);null===(l=document.getElementById(n.MOVERIGHT_LINK))||void 0===l?void 0:l.addEventListener("click",function(){return s(p.MOVE_RIGHT)},!1);null===(q=document.getElementById(n.MOVETO_ICON_LINK))||void 0===q?void 0:q.addEventListener("click",function(){return s(p.MOVE_TO)},!1);t.resolve();case 15:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.init=q;var r=function(a,b){var c=[];if("undefined"!=typeof b&&b===o.SECTION_SELECT_DESCRIPTION_VALUE){return}else if("undefined"!=typeof b&&b===o.SECTION_NUMBER_ALL_PLACEHOLDER){for(var d in k){for(var e=0;e<k[d].length;e++){c.push(k[d][e].boxId)}}}else{k[b].forEach(function(a){return c.push(a.boxId)})}for(var f=0;f<c.length;f++){document.getElementById(c[f]).checked=a}};a.setSectionSelection=r;var s=function(a){var b={action:a,moduleIds:[]};for(var d in k){for(var e=0,f;e<k[d].length;e++){f=document.getElementById(k[d][e].boxId);if(f.checked){b.moduleIds.push(k[d][e].moduleId)}}}if(0===b.moduleIds.length){t(c.get_string("noitemselected","block_massaction"));return!1}switch(a){case p.HIDE:case p.SHOW:case p.MAKE_AVAILABLE:case p.DUPLICATE:case p.MOVE_LEFT:case p.MOVE_RIGHT:break;case p.DELETE:break;case p.MOVE_TO:b.moveToTarget=document.getElementById(n.MOVETO_SELECT).value;if(""===b.moveToTarget.trim()){t(c.get_string("nomovingtargetselected","block_massaction"));return!1}break;default:t("Unknown action: "+a+". Coding error.");return!1;}document.getElementById(n.HIDDEN_FIELD_REQUEST_INFORMATION).value=JSON.stringify(b);document.getElementById(n.ACTION_FORM).submit();return!0},t=function(a){Promise.resolve([c.get_string("error","core"),a,c.get_string("back","core")]).then(function(a){require(["core/notification"],function(b){b.alert(a[0],a[1],a[2]).then().catch()});return null}).catch()},u=function(a){if(l){return}l=!0;setTimeout(function(){var c=d.default.call([{methodname:"block_massaction_get_sections",args:{courseId:a}},{methodname:"block_massaction_get_modulesinfo",args:{courseId:a}}]);Promise.all([c[0],c[1]]).then(function(a){k=(0,b.default)(a[0],a[1]);l=!1;return!0}).catch(function(){l=!1;return!1})},1e3)},v=function(a){for(var b=[],c=function(a){for(var d=0,e;d<a.childNodes.length;d++){e=a.childNodes[d];c(e);b.push(e)}},d=0;d<a.length;d++){c(a[d])}return b}});
//# sourceMappingURL=massactionblock.min.js.map
